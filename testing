
<?php

// Merchant key here as provided by Payu
$MERCHANT_KEY = "";

// Merchant Salt as provided by Payu
$SALT = "";
// For test Mode https://test.payu.in
// End point - change to https://secure.payu.in for LIVE mode
$PAYU_BASE_URL = "https://secure.payu.in";
//$PAYU_BASE_URL = "https://test.payu.in";

$action = '';

$posted = array();
if(!empty($_POST)) {
    //print_r($_POST);
  foreach($_POST as $key => $value) {    
    $posted[$key] = $value; 
	
  }
}

$formError = 0;

if(empty($posted['txnid'])) {
  // Generate random transaction id
  $txnid = substr(hash('sha256', mt_rand() . microtime()), 0, 20);
} else {
  $txnid = $posted['txnid'];
}
$hash = '';
// Hash Sequence
$hashSequence = "key|txnid|amount|productinfo|firstname|email|udf1|udf2|udf3|udf4|udf5|udf6|udf7|udf8|udf9|udf10";
if(empty($posted['hash']) && sizeof($posted) > 0) {
  if(
          empty($posted['key'])
          || empty($posted['txnid'])
          || empty($posted['amount'])
          || empty($posted['firstname'])
          || empty($posted['email'])
          || empty($posted['phone'])
          || empty($posted['productinfo'])
          || empty($posted['surl'])
          || empty($posted['furl'])
		  || empty($posted['service_provider'])
  ) {
    $formError = 1;
  } else {
    //$posted['productinfo'] = json_encode(json_decode('[{"name":"tutionfee","description":"","value":"500","isRequired":"false"},{"name":"developmentfee","description":"monthly tution fee","value":"1500","isRequired":"false"}]'));
	$hashVarsSeq = explode('|', $hashSequence);
    $hash_string = '';	
	foreach($hashVarsSeq as $hash_var) {
      $hash_string .= isset($posted[$hash_var]) ? $posted[$hash_var] : '';
      $hash_string .= '|';
    }

    $hash_string .= $SALT;


    $hash = strtolower(hash('sha512', $hash_string));
    $action = $PAYU_BASE_URL . '/_payment';
  }
} elseif(!empty($posted['hash'])) {
  $hash = $posted['hash'];
  $action = $PAYU_BASE_URL . '/_payment';
}
?>
<html>
  <head>
  <script>
    var hash = '<?php echo $hash ?>';
    function submitPayuForm() {
      if(hash == '') {
        return;
      }
      var payuForm = document.forms.payuForm;
      payuForm.submit();
    }
  </script>
   <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Donation Page</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
	<link rel="stylesheet" href="css/style.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	
	<link href="https://fonts.googleapis.com/css?family=Great+Vibes&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900&display=swap" rel="stylesheet">
<link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
<script type="text/javascript">

	$(document).ready(function(){
    $('#country').on('change', function(){
        var countryID = $(this).val();
        if(countryID){
            $.ajax({
                type:'POST',
                url:'ajaxData.php',
                data:'country_id='+countryID,
                success:function(html){
                    $('#state').html(html);
                    $('#city').html('<option value="">Select state first</option>'); 
                }
            }); 
        }else{
            $('#state').html('<option value="">Select country first</option>');
            $('#city').html('<option value="">Select state first</option>'); 
        }
    });
	 });
</script>
  </head>
  <style>
  .payment-outerc {
    width: 100%;
    float: left;
}
.payment-outerc h2 {
    text-align: center;
    padding-bottom: 50px;
}
.outer-payc {
    width: 60%;
    margin: 0 auto;
}
  input.submitcbutton {
    background: red;
    text-align: center;
    margin: 0 auto;
    width: 100%;
    border: 0;
    color: #fff;
    padding: 10px 50px;
    float: right;
}
.outer-payc input {
    border: 0px;
    border-bottom: 1px solid #ccc;
}
.outer-payc label {
    font-weight: normal;
}
.mb40{
	margin-bottom:40px;
}
.row.mb40.submitcb button {
    padding: 0px;
    border: 0px;
}
.row.mb40.submitcb {
    float: right;
}
  </style>
  <body onload="submitPayuForm()">
  <div class="payment-outerc">
  <div class="container">
    <h2>Donation</h2>
   
    <?php if($formError) { ?>
	
      <span style="color:red">Please fill all mandatory fields.</span>
      <br/>
      <br/>
    <?php } ?>
    <form action="<?php echo $action; ?>" method="post" name="payuForm">
      <input type="hidden" name="key" value="<?php echo $MERCHANT_KEY ?>" />
      <input type="hidden" name="hash" value="<?php echo $hash ?>"/>
      <input type="hidden" name="txnid" value="<?php echo $txnid ?>" />
	  <div class="outer-payc">
      <table>
		<div class="row mb40">
		<div class="col-md-6">		  
          <div class="form-group">
            
            <input  type="hidden" name="amount" class="form-control" value="<?php echo (empty($_GET['amount'])) ? '' : $_GET['amount']; ?>" />
          </div>
		  </div>
		  <div class="col-md-6">
          <div class="form-group">
            
            <input maxlength="100" type="hidden"  name="productinfo" type="text" class="form-control" value="<?php echo (empty($_GET['donationcat'])) ? '' : $_GET['donationcat']; ?>"placeholder="Enter Last Name" />
          </div>
		</div>
		</div>
			<div class="row mb40">
		<div class="col-md-6">		  
          <div class="form-group">
            <label class="control-label">First Name</label>
            <input name="firstname" class="form-control" placeholder="First Name" id="firstname" value="<?php echo (empty($posted['firstname'])) ? '' : $posted['firstname']; ?>" />
          </div>
		  </div>
		  <div class="col-md-6">
          <div class="form-group">
            <label class="control-label">Last Name</label>
            <input name="lastname" class="form-control" placeholder="Last Name"id="lastname" value="<?php echo (empty($posted['lastname'])) ? '' : $posted['lastname']; ?>" />
          </div>
		</div>
		</div>
		<div class="row mb40">
		<div class="col-md-6">		  
          <div class="form-group">
            <label class="control-label">Email:</label>
            <input name="email" class="form-control" placeholder="Email"id="email" value="<?php echo (empty($posted['email'])) ? '' : $posted['email']; ?>" />
          </div>
		  </div>
		  <div class="col-md-6">
          <div class="form-group">
            <label class="control-label">Phone:</label>
            <input name="phone" class="form-control" placeholder="Phone"value="<?php echo (empty($posted['phone'])) ? '' : $posted['phone']; ?>" />
          </div>
		</div>
		</div>
		<div class="row mb40">
		<div class="col-md-6">		  
          <div class="form-group">
            <label class="control-label">Country:</label>
            <?php $conn = new mysqli("localhost", "root", "", "jolly"); ?>
		  	 <?php

			//$con = mysqli_connect("localhost","mvp_nectorclean","nectorclean@123","mvp_nectorclean");

			//Fetch all the country data

			$query = $conn->query("SELECT * FROM countries");
			//Count total number of rows 
			$rowCount = $query->num_rows;
			?>
			<select id="country" class="form-control" name="country_id">
				<option value="" >Country</option>
				<?php
				if($rowCount > 0){
					while($row = $query->fetch_assoc()){ 
						echo '<option value="'.$row['country_id'].'">'.$row['country_name'].'</option>';
					}
				}else{
					echo '<option value="">Country not available</option>';
				}
				?>
			</select>
          </div>
		  </div>
		<div class="col-md-6">		  
            <div class="form-group">
   <select id="state" name="state_id" class="form-control">
    <option value="">Select country first</option>
</select>
  </div>
		  </div>
		</div>
			<div class="row mb40">
		<div class="col-md-6">		  
          <div class="form-group">
            <label class="control-label">City:</label>
            <input name="city" class="form-control" placeholder="City"value="<?php echo (empty($posted['city'])) ? '' : $posted['city']; ?>" />
          </div>
		  </div>
		  <div class="col-md-6">
          <div class="form-group">
            <label class="control-label">Zipcode:</label>
            <input name="zipcode" class="form-control" placeholder="Zipcode"value="<?php echo (empty($posted['zipcode'])) ? '' : $posted['zipcode']; ?>" />
          </div>
		</div>
		</div>
		<div class="row mb40">
		<div class="col-md-12">		  
          <div class="form-group">
            <label class="control-label">Building / Flat no:</label>
			  <textarea name="address1" required="required" class="form-control" placeholder="Building / Flat no" ><?php echo (empty($posted['address1'])) ? '' : $posted['address1']; ?></textarea>
            
          </div>
		  </div>
		</div>
		<div class="row mb40 submitcb">
		<div class="col-md-12">		  
          <button><input class="submitcbutton" type="submit" value="Submit" /></button>
		  </div>
		</div>
		
        <tr>
         
          <td colspan="3"><input type="hidden" name="surl" value="http://localhost/jolly/success.php<?php //echo (empty($posted['surl'])) ? '' : $posted['surl'] ?>" size="64" /></td>
        </tr>
        <tr>
          
          <td colspan="3"><input  type="hidden" name="furl" value="http://localhost/jolly/failure.php<?php //echo (empty($posted['furl'])) ? '' : $posted['furl'] ?>" size="64" /></td>
        </tr>

        <tr>
          <td colspan="3"><input type="hidden" name="service_provider" value="payu_paisa" size="64" /></td>
        </tr>
        <tr>
         
          <td><input type="hidden" name="curl" value="" /></td>
        </tr>
        <tr>
          
          <td><input type="hidden" name="address1" value="<?php echo (empty($posted['address1'])) ? '' : $posted['address1']; ?>" /></td>
          
          <td><input type="hidden" name="address2" value="<?php echo (empty($posted['address2'])) ? '' : $posted['address2']; ?>" /></td>
        </tr>       

        <tr>
         
          <td><input type="hidden" name="udf1" value="<?php echo (empty($posted['udf1'])) ? '' : $posted['udf1']; ?>" /></td>
         
          <td><input type="hidden" name="udf2" value="<?php echo (empty($posted['udf2'])) ? '' : $posted['udf2']; ?>" /></td>
        </tr>
        <tr>
         
          <td><input  type="hidden" name="udf3" value="<?php echo (empty($posted['udf3'])) ? '' : $posted['udf3']; ?>" /></td>
        
          <td><input type="hidden" name="udf4" value="<?php echo (empty($posted['udf4'])) ? '' : $posted['udf4']; ?>" /></td>
        </tr>
        <tr>
          
          <td><input type="hidden" name="udf5" value="<?php echo (empty($posted['udf5'])) ? '' : $posted['udf5']; ?>" /></td>
          
          <td><input type="hidden" name="pg" value="<?php echo (empty($posted['pg'])) ? '' : $posted['pg']; ?>" /></td>
        </tr>
        <tr>
          <?php if(!$hash) { ?>
            <td> </td>
          <?php } ?>
        </tr>
      </table>
	  </div>
    </form>
	</div>
	</div>
  </body>
</html>
